LTLIBRARY_NAME          = libimlib.la
LTLIBRARY_SOURCES       = php_imlib.c gen_imlib.c
LTLIBRARY_LIBADD        = $(IMLIB_SHARED_LIBADD)
LTLIBRARY_SHARED_NAME   = php_gtk_imlib.la
LTLIBRARY_SHARED_LIBADD = $(IMLIB_SHARED_LIBADD)

include $(top_srcdir)/build/dynlib.mk

php_imlib.o php_imlib.lo php_imlib.slo: gen_ce_imlib.h

gen_imlib.c: imlib.defs imlib.overrides
	$(PHP) -q $(top_srcdir)/generator/generator.php -o $(srcdir)/imlib.overrides -p imlib -r $(top_srcdir)/ext/gtk%2b/gtk.defs $(srcdir)/imlib.defs > gen_imlib.c

gen_ce_imlib.h: gen_imlib.c
	grep -h "^PHP_GTK_EXPORT_CE" gen_imlib.c | sed -e "s!^!extern !" > gen_ce_imlib.h

