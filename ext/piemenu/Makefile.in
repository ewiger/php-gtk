LTLIBRARY_NAME          = libpiemenu.la
LTLIBRARY_SOURCES       = php_piemenu.c gen_piemenu.c gdkaddons.c gtkaddons.c gtkpiemenu.c
LTLIBRARY_LIBADD        = $(PIEMENU_SHARED_LIBADD)
LTLIBRARY_SHARED_NAME   = php_gtk_piemenu.la
LTLIBRARY_SHARED_LIBADD = $(PIEMENU_SHARED_LIBADD)

include $(top_srcdir)/build/dynlib.mk

php_piemenu.o php_piemenu.lo php_piemenu.slo: gen_ce_piemenu.h

gen_piemenu.c: piemenu.defs piemenu.overrides
	$(PHP) -q $(top_srcdir)/generator/generator.php -o $(srcdir)/piemenu.overrides -p PieMenu -r $(top_srcdir)/ext/gtk%2b/gtk.defs $(srcdir)/piemenu.defs > gen_piemenu.c

gen_ce_piemenu.h: gen_piemenu.c
	grep -h "^PHP_GTK_EXPORT_CE" gen_piemenu.c | sed -e "s!^!extern !" > gen_ce_piemenu.h

